% clear all
% q0=[0.23530170809504386	-0.3694238497972596	-0.9729202805745709	-0.41214483146042336	-0.03471714732326214	-1.2451882963052734	-0.4245588191806831];
% a=[0.06498254930378869	1.292745619307008	             2.2309929361890357	            0.047780252422122034	                  1.6493751238945538	0.5868515245548084                  0.18905128116424985	
% 0.4230836858879671	             -0.016655111708000957	0.033006122715290194	0.35160430466311143	0.199583122381347	                 1.0654671129286857	0.26494636202209987	
% -0.7474717005443657	-0.6046710840336539	0.28885406559723664	0.12632516230939653	-0.2251043951803059	0.16742593441614853	-0.4837954006153597	
% 0.25429628499569146	0.09389376177361328	-0.780971417583991	                -0.2021984727209319	0.24521575507182428	-0.8195275264074452	0.11574537934663995	
% 0.06281600811456378	0.03580056180225173	-0.007936341610337712	-0.06423409155759886	-0.47081824068471295	0.011609310399386709	0.05389213585203395	]';
% b=[-0.018210056372817262	0.08101199009325344	-0.6801575985645264	0.020762480060566794	-0.06536095065287234	0.7156005527325381 	0.6642997471488384	
% 0.65239441130778	                   0.3397696576919927	0.3586557420323316	                -0.12284791222108923	-0.22155802848729605	0.15805170308719857	0.2862044054790565	
% -0.5164663142713403	-0.05653062327799034	0.055142610428603286	-0.23692624498853967	-0.025881021391523328	0.27970618187124174	-0.6653025823647677	
% 0.03056053047543969	-0.13193852165499576	-0.20138724677796013	-0.12711195541438963	0.029975613949763714	-0.21729105436747098	-0.0012177364541889855	
% 0.06271443007907061	0.047188053403901684	0.07887253184007607	0.1854702664120218	             0.028196497357035923	-0.01544747184424327	0.16792358621890374]';
% q0=[0.1925703676902296	0.10462131155152099 	0.039980171012471	-1.4757947363528381	-0.92064592699124	-0.4513174836985595	0.7603004233352909];
% a=[0.7817931615800204	-0.026234123491523507	0.5711360959404677	0.08337297352634628	-0.8968198288111306	0.35052104565623116	-0.27298461345973657	
% -0.38978826685401485	0.19510467841299717	-0.17786252174884123	0.2327218585439516	-0.009026384455901395	-0.43820445963962845	-0.018224979752091475	
% 0.20077387050095782	-0.09581581007253036	-0.346353323095648	-0.32775437340811236	0.6370214857594203	-0.3473532398462653	0.012543819992275385	
% -0.1054546025878612	0.36402275666248166	0.03331813978573724	0.2442366310337505	-0.09024110044944625	1.1610786243859621	0.03444221848270621	
% -0.4872872673639862	-0.4370775611160697	0.14979342309743307	-0.23256522837162572	0.35907518588628773	-0.8160423728859187	0.24422355473867596]';
% b=[-0.5031289135727856	0.5301118487927248	-0.025997179198334316	0.14737274534822195	0.39304736965120235	0.15405162784959858	0.2424520204758588	
% -0.4079706835570794	-0.1442891474207629	-0.356714614804743	-0.583785172202542	0.8422684849835821	0.43795693633755106	0.05177339402869968	
% -0.10896007659971114	-0.48871500466004386	0.6247434600700656	-0.5089248938512789	-0.5395202790091768	0.18098866320003074	0.9894702414814368	
% 0.2294609738534704	-0.5345867501911367	-0.29964797100517465	0.5465420211423193	-0.36914763669672696	-0.22005340092166545	-0.9408834497147094	
% -0.32526381328282907	0.5806028263063399	-0.3269895220924388	-0.26290762214590757	0.2036850970382576	-0.13857950100735042	0.02984680557122365]';
% q0=[0.193	0.105 	0.040	-1.476	-0.921	-0.451	0.760];
% a=[0.782	-0.026	0.571	0.083	-0.897	0.351	-0.273;	
% -0.390	0.195	-0.178	0.233	-0.009	-0.438	-0.018;
% 0.201	-0.096	-0.346	-0.328	0.637	-0.347	0.013;	
% -0.105	0.364	0.033	0.244	-0.090	1.161	0.034;	
% -0.487	-0.437	0.150	-0.232	0.359	-0.816	0.244]';
% b=[-0.503         0.530	-0.026	0.147	0.393	0.154	0.242;	
%     -0.408	        -0.144	-0.357	-0.584	0.842	0.438	0.052;	
%     -0.109        -0.489	0.625	-0.509	-0.540	0.181	0.989;	
%     0.229	      -0.535	-0.300	0.547	-0.369	-0.220	-0.941;	
%    -0.325	        0.581	-0.327	-0.263	0.204	-0.139	0.030]';
% q0=[0.162385260245385	-0.162431330020337	-0.0267120529398158	-0.540411113028759	-0.679293854093198	-0.725809212919391	0.0646664306757003];
% a=[0.0820501329508389	1.19407154752945 0.181967577633918	-0.0512133701258808	-0.156738033088113	0.161912009447830	-0.0986191786497442	;
% 0.414092230859053	-0.109075301905946	-0.251608774393722	0.413293418090662	0.949794273898213	0.508436421484915	0.324324458087942;	
% -0.357254680426496	-0.310539585013145	0.262840791511493	0.127913258626981	0.114874580572749	-0.102896605101840	0.155983665446672;	
% 0.219747412744245	-0.0380840540924746	0.0942334985725945	-0.189461875451287	-0.152039241531067	0.0812328569860471	-0.0685793942493624;	
% 0.120507959130728	0.0216068055262789	-0.148841279447422	-0.000253148024801008	-0.295863458054721	-0.239005293013235	-0.148732631374506]';
% b=[0.0546895173126779	0.0734823535904398	-0.0689976478026182	0.0169975804134847	-0.0481662880933481	0.214125156921186	0.732973729650913;	
% 0.153953254604944	0.269079683737703	0.283826607396832	-0.210514579504279	-0.715373905140788	0.0773540194208421	0.563901777752970;	
% -0.327532306666605	-0.0435734793209911	-0.107289835608999	-0.148249603309052	-0.230631873805133	-0.0354070930304785	-0.561500599571997;	
% 0.104676612839812	0.000613301867082299	0.00216289893456138	-0.216484452025922	0.237330501169447	0.211961243576525	0.259707216389894;	
% 0.0160984967535870	-0.0306981041825178	-0.101417148604475	0.124922336004196	0.0475490686748180	-0.143850291782626	-0.131615636270870]';
% q0=[0.162   2/3*(-0.162+0.5)	-0.027	-0.540-0.4	-0.679	-0.726	0.065+1.5];
% a=[0.082	2/3*1.194    0.182	-0.051	-0.157	0.162	-0.099;
% 0.414	2/3*-0.109	-0.252	0.413	0.950	0.508	0.324;	
% -0.357	2/3*-0.311	0.263	0.128	0.115	-0.103	0.156;	
% 0.220	2/3*-0.038	0.094	-0.189	-0.152	0.081	-0.069;	
% 0.121	2/3*0.022	-0.149	-0.0003	-0.296	-0.239	-0.149]';
% b=[0.054  2/3*0.073	-0.069	0.017	-0.048	0.214	0.733;	
% 0.154	 2/3*0.269	0.284	-0.211	-0.715	0.077	0.564;	
% -0.328	2/3*-0.044	-0.107	-0.148	-0.231	-0.035	-0.562;	
% 0.105	 2/3*0.001	0.002	-0.216	0.237	0.212	0.260;	
% 0.016	2/3*-0.031	-0.101	0.125	0.048	-0.144	-0.132]';
% q0=1/2*[0.246776392623472	-0.232555111198103	-0.313701845233227	-0.584079837410886	-0.796481607623353	0.504026147621708	0.0265576252420388+1];
% a=1/2*[0.0649371779997108	1.07614162180712  	0.396385676075408	0.0162750124516093	1.38934488892494	              0.0561638313766951	0.128431258944603	
% 0.425093375854139	-0.0563687456490540	-0.339413824590960	0.369686145325117	-0.00423708389538341	0.431298675921398	0.0322001587445006	
% -0.762190817987329	-0.302458054130836	0.594525876899086	0.117922364257261	-0.147067391155693	-0.184764785812903	-0.321206934002678	
% 0.240762411704359	-0.0729231515929734	0.218952934308436	-0.229431775002773	0.0991742120065555	-0.386112601534397	-0.150438232840102	
% 0.0816797754872145	0.0471325276509827	-0.475389478967218	-0.0383374591726328	-0.266003547888500	0.235996716071499	0.274508431387107]';
% b=1/2*[-0.00891104328960483	0.0631611422686268	-0.126090106385184	0.0189711613355151	-0.0553380563079018	0.107208622662974	0.526499634821682	
% 0.661883604937703	0.209309563564163	0.854868128846040	-0.163319161873798	-0.0585014567198756	0.0648410511739715	0.195462222399006	
% -0.520727090797381	-0.0613090848116058	-0.119302661519606	-0.202925907311174	0.0371863374545500	-0.0412353962378956	-0.239489208514210	
% 0.0558355716942970	-0.0281246345229803	0.0388796791316543	-0.153139257927019	-2.13378057197942e-05	-0.105533631957369	0.394148116813652	
% 0.0461820517442595	0.00405506076593959	-0.113669332857278	0.196434671151732	-0.00179966996048046	0.0677233540040104	-0.218372620671350]';
q0=optimresults.x(1:7);
for i=1:5
    a(:,i)=optimresults.x(7*i+1:7*i+7);
end
for i=1:5
    b(:,i)=optimresults.x(7*i+36:7*i+42);
end
%2 q0(2)=q0(2)+1;
%     q0(7)=q0(7)+1.4;%0
 q0(7)=q0(7)+1;%1
q0(2)=2/3*q0(2)-0.3;
a(2,:)=2/3*a(2,:);
b(2,:)=2/3*b(2,:);
q0=roundn(q0,-3);
a=roundn(a,-3);
b=roundn(b,-3);
q=zeros(1,7);
dq=zeros(1,7);
ddq=zeros(1,7);
syms j
% temp=0.1;
tend=10;
t_cont=0;
x_t0=[0;0;100;899];
for t=0:0.01:tend
% t=0.8
%     for i=1:7
%         q(i)=0;
%         dq(i)=0;
%         ddq(i)=0;
% 	    for j=1:5
%     		q(i)=5*a(i,j)/(pi*j)*sin(pi/5*j*t)-5*b(i,j)/(pi*j)*cos(pi/5*j*t)+q(i);
%     		dq(i)=a(i,j)*cos(pi/5*j*t)+b(i,j)*sin(pi/5*j*t)+dq(i);
%     		ddq(i)=-pi*j*a(i,j)/5*sin(pi/5*j*t)+pi*j*b(i,j)/5*cos(pi/5*j*t)+ddq(i);
% 	    end
% 	    q(i)=q(i)+q0(i);
%     end
    for i=1:7
        q(i)=0;
        dq(i)=0;
        ddq(i)=0;
	    for j=1:5
    		q(i)=a(i,j)*sin(pi/5*j*t)+b(i,j)*cos(pi/5*j*t)+q(i);
    		dq(i)=a(i,j)*pi/5*j*cos(pi/5*j*t)-b(i,j)*pi/5*j*sin(pi/5*j*t)+dq(i);
    		ddq(i)=-pi^2*j^2*a(i,j)/25*sin(pi/5*j*t)-pi^2*j^2*b(i,j)/25*cos(pi/5*j*t)+ddq(i);
	    end
	    q(i)=q(i)+q0(i);
    end
    
    
    T=ForwardKinematics(q);
    x(:,t_cont+1)=T*x_t0*0.001;
    t_cont=t_cont+1;
    for i=1:7
        q_jishu(t_cont,i)=q(i);
         q_jishu=roundn(q_jishu,-5);
    end
    for i=1:7
        y(t_cont,i)=q(i);
        dy(t_cont,i)=dq(i);
        ddy(t_cont,i)=ddq(i);
    end
    m(t_cont)=t;
end
 % save theta0.txt -ascii q_jishu
% for i=1:7
%      figure(i);
% %      title(['关节',num2str(i)]);
%      subplot(3,1,1);
% plot(m,y(:,i));
% xlabel('时间(s)');
% ylabel('角度(rad)')
% subplot(3,1,2);
% plot(m,dy(:,i));
% xlabel('时间(s)');
% ylabel('角速度(rad/s)');
% subplot(3,1,3);
% plot(m,ddy(:,i));
% xlabel('时间(s)');
% ylabel('角加速度(rad/s^2)');
% %     plot(m,y(:,i));
% %     xlabel('时间(s)');
% %     ylabel('角度(rad)')
% %     title(['关节',num2str(i)]);
% %     hold on
% end
% figure(8);
% plot3(x(1,:),x(2,:),x(3,:));
% grid on;
% subplot(3,1,1);
% plot(m,y(:,1));
% xlabel('时间(s)');
% ylabel('角度(rad)')
% subplot(3,1,2);
% plot(m,dy(:,1));
% xlabel('时间(s)');
% ylabel('角速度(rad/s)');
% subplot(3,1,3);
% plot(m,ddy(:,1));
% xlabel('时间(s)');
% ylabel('角加速度(rad/s^2)');
% title(['关节',num2str(i)]);
% for i=1:7
%     figure(i+14)
%     plot(m,y(:,i));
%     hold on
%     plot(m,A(200:10200),i+7);
% end